<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>语法开发 | OpenEX</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/OpenEXDoc/logo.png">
    <meta name="description" content="OpenEX 面向过程脚本语言">
    
    <link rel="preload" href="/OpenEXDoc/assets/css/0.styles.aeecdd65.css" as="style"><link rel="preload" href="/OpenEXDoc/assets/js/app.0b078796.js" as="script"><link rel="preload" href="/OpenEXDoc/assets/js/2.4c546f0b.js" as="script"><link rel="preload" href="/OpenEXDoc/assets/js/1.80356216.js" as="script"><link rel="preload" href="/OpenEXDoc/assets/js/30.ee69313e.js" as="script"><link rel="prefetch" href="/OpenEXDoc/assets/js/10.c3b7a0fc.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/11.732cf3e0.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/12.895b5595.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/13.9426da25.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/14.856c1518.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/15.758ee11b.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/16.e925b239.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/17.5b873df7.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/18.4c170722.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/19.a45744ea.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/20.c22d9498.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/21.a45f0526.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/22.431e66aa.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/23.4ee790cc.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/24.48c05d5f.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/25.db006da9.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/26.7255540f.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/27.8721e18f.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/28.10b09354.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/29.99e4ca5f.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/3.4db2e19a.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/31.7fa9f044.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/32.8617a51e.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/33.bdb5976a.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/34.4e6625fc.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/35.f45697af.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/36.ea3c2746.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/37.b9f3bf39.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/38.b48b1fff.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/4.45665f8a.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/5.b31b942f.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/6.4910e764.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/7.c5640ac7.js"><link rel="prefetch" href="/OpenEXDoc/assets/js/vendors~docsearch.77260563.js">
    <link rel="stylesheet" href="/OpenEXDoc/assets/css/0.styles.aeecdd65.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/OpenEXDoc/zh/" class="home-link router-link-active"><img src="/OpenEXDoc/icon.png" alt="OpenEX" class="logo"> <span class="site-name can-hide">OpenEX</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/OpenEXDoc/" class="nav-link router-link-active">
  🏡首页
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/api.html" class="nav-link">
  📖Runtime API
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/issues.html" class="nav-link">
  🎲问题解决
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/help/" class="nav-link">
  🚀语法
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/start.html" class="nav-link">
  ⚡快速上手
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/OpenEXDoc/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/OpenEXDoc/zh/extend/parser.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  zh-CN
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/OpenEXDoc/" class="nav-link router-link-active">
  🏡首页
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/api.html" class="nav-link">
  📖Runtime API
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/issues.html" class="nav-link">
  🎲问题解决
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/help/" class="nav-link">
  🚀语法
</a></div><div class="nav-item"><a href="/OpenEXDoc/zh/start.html" class="nav-link">
  ⚡快速上手
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/OpenEXDoc/en/" class="nav-link">
  en-US
</a></li><li class="dropdown-item"><!----> <a href="/OpenEXDoc/zh/extend/parser.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  zh-CN
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>开始</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础教程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>扩展开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/OpenEXDoc/zh/extend/" aria-current="page" class="sidebar-link">基础开发</a></li><li><a href="/OpenEXDoc/zh/extend/struct.html" class="sidebar-link">项目结构</a></li><li><a href="/OpenEXDoc/zh/extend/parser.html" aria-current="page" class="active sidebar-link">语法开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/OpenEXDoc/zh/extend/parser.html#语句分割" class="sidebar-link">语句分割</a></li><li class="sidebar-sub-header"><a href="/OpenEXDoc/zh/extend/parser.html#文档编写中" class="sidebar-link">文档编写中</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="语法开发"><a href="#语法开发" class="header-anchor">#</a> 语法开发</h1> <p>本文档主要介绍了如何基于OpenEX创建新的语法结构</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>OpenEX的语法解析为有限自动机架构,每次流程将解析出一条语句</p></div> <hr> <p>在<code>OpenEX</code>中,一条语句的头部必须为关键字,如果为标识符,OpenEX则会自动判断该条字段为表达式并送入<code>ExpressionParser</code>进行进一步解析</p> <p>以下例子中,我们创建一个 <strong>定义if语句</strong> 的分析器</p> <h2 id="语句分割"><a href="#语句分割" class="header-anchor">#</a> 语句分割</h2> <p>在什么类型的<code>Parser</code>中创建对您的语句相关的解析流程,代表您的语句可以被定义在什么位置</p> <h3 id="脚本根"><a href="#脚本根" class="header-anchor">#</a> 脚本根</h3> <p>您需要在<code>io.github.mczzcs.compiler.parser.Parser</code>类中<code>getParser</code>方法的<code>switch</code>语句中创建<code>case &quot;if&quot; -&gt; {}</code>一条判断分支,否则OpenEX将直接抛出编译型异常: <code>不是语句</code></p> <p>然后根据您的语句结构,规定解析流程</p> <ul><li>if语句的结构为<code>if ( 布尔表达式 ) { 代码块 }</code></li></ul> <p>此时我们新建一个对象<code>Token t = getToken();</code>用于获取下一个词素<br>
按照我们的语法结构, &quot;不出意外&quot; 的话获取到的 <code>t</code> 应该是左括号 <code>(</code><br>
所以为了防止意外发生,我们应该加上一条if语句去判断</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LP</span> 
    <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CompileException</span><span class="token punctuation">(</span><span class="token string">&quot;'(' expected.&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> filename<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果不为 '(' 则抛出编译型异常             </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p>左括号对应的词素类型为<code>LP</code>,对应id是7</p></blockquote> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>因为OpenEX词法分析机制,&quot;值&quot;也被算作一个词素,所以诸如<code>&quot;(&quot;</code>这样的字符串也被看做一个值,单纯的通过<code>getData</code>方法获取词素的数据会发生语法的错误判断,所以OpenEX词法分析器给每个词素都打上了其对应的类型,防止此类事情发生</p></div> <p>然后我们可以根据括号组合获取表达式的整体字段</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Token</span><span class="token punctuation">&gt;</span></span> vars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
t <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LP</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        vars<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        index <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LR</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        index <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        vars<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LR</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

    vars<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    t <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这个时候,列表<code>vars</code>存储的就是表达式的整体字段了,然后我们丢入<code>ExpressionParser</code>类对表达式进行解析</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">ExpressionParsing</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExpressionParsing</span><span class="token punctuation">(</span>vars<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 其中,因为我们是直接在Parser类中编写,所以构造函数第二个形参填写'this'即可</span>
<span class="token comment">// 'c' 成员实例对象代表一个`Compiler` OpenEX标准编译器</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>然后我们该解析由<code>{}</code>大括号括起来的代码块了<br>
我们再次调用<code>getToken()</code>获取一次词素,并判断是否为 <code>{</code> 左括号</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>t <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LP</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">CompileException</span><span class="token punctuation">(</span><span class="token string">&quot;Missing statement body.&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>接着我们分割出代码块的内容</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Tokens</span><span class="token punctuation">&gt;</span></span> groups <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{</span>
    t <span class="token operator">=</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LP</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Token</span><span class="token punctuation">.</span><span class="token constant">LR</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> i <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    groups<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>此时得到的<code>groups</code>就是代码块中的所有词素了,然后我们丢入<code>SubParser</code>类中解析语句块的内容即可</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SubParser</span> sp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubParser</span><span class="token punctuation">(</span>groups<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> c<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//初始化一个子解析器,其中传入的groups代表我们分割好的语句块</span>
<span class="token comment">// this 为Parser类</span>
<span class="token comment">// c 为 Compiler类</span>
<span class="token comment">// 第一个false为判断是否是在function语句块内,但是我们是在脚本根解析,所以填上false</span>
<span class="token comment">// 第二个false为判断是否是在while语句块内</span>
<span class="token comment">// 第三个null只有在function语句块内才能获取到,我们因为是在脚步根,直接填null即可</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>至此,我们的if语句前端语句分割部分就完成了<br>
然后我们在Parser同级包下创建一个叫<code>IfParser</code>的类,代表我们的if语句的语法/语义混合解析器</p> <p>首先我们继承<code>BaseParser</code>接口,并实现其中的方法</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>mczzcs<span class="token punctuation">.</span>compile<span class="token punctuation">.</span>parser</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>mczzcs<span class="token punctuation">.</span>compile<span class="token punctuation">.</span></span><span class="token class-name">Compiler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>mczzcs<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CompileException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>mczzcs<span class="token punctuation">.</span>exe<span class="token punctuation">.</span>code<span class="token punctuation">.</span></span><span class="token class-name">ASTNode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>github<span class="token punctuation">.</span>mczzcs<span class="token punctuation">.</span>exe<span class="token punctuation">.</span>code<span class="token punctuation">.</span>struct<span class="token punctuation">.</span>decide<span class="token punctuation">.</span></span><span class="token class-name">IfNode</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IfParser</span> <span class="token keyword">implements</span> <span class="token class-name">BaseParser</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ASTNode</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token class-name">Parser</span> parser<span class="token punctuation">,</span> <span class="token class-name">Compiler</span> compiler<span class="token punctuation">,</span><span class="token class-name">FunctionParser</span> functionParser<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">CompileException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>然后我们使其能接受<code>Parser</code>传来的参数,我们添加一个构造方法和一些成员对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ASTNode</span><span class="token punctuation">&gt;</span></span> bool<span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BaseParser</span><span class="token punctuation">&gt;</span></span> group<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">IfParser</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ASTNode</span><span class="token punctuation">&gt;</span></span> bool<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BaseParser</span><span class="token punctuation">&gt;</span></span> group<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>bool <span class="token operator">=</span> bool<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>group <span class="token operator">=</span> group<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后我们在实现<code>BaseParser</code>的方法内详细编写混合解析器需要做的事,话不多说直接上代码</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ASTNode</span><span class="token punctuation">&gt;</span></span> groups <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">BaseParser</span> bp<span class="token operator">:</span>group<span class="token punctuation">)</span><span class="token punctuation">{</span>
    groups<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bp<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>parser<span class="token punctuation">,</span> compiler<span class="token punctuation">,</span>functionParser<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">IfNode</span><span class="token punctuation">(</span>bool<span class="token punctuation">,</span>groups<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>最重要的一点,你需要在eval方法中返回继承于<code>ASTNode</code>接口的执行节点,每个执行节点实现其中的<code>executor</code>方法</p> <blockquote><p>执行节点的功能并不是由执行引擎实现的,而是每个执行节点类去实现的,执行引擎只是调用该方法并执行</p></blockquote> <hr> <h2 id="文档编写中"><a href="#文档编写中" class="header-anchor">#</a> 文档编写中</h2> <p>详细的实现参考源码 <code>io.github.mczzcs.exe.code.struct.IfNode</code>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/OpenEXDoc/zh/extend/struct.html" class="prev">
        项目结构
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/OpenEXDoc/assets/js/app.0b078796.js" defer></script><script src="/OpenEXDoc/assets/js/2.4c546f0b.js" defer></script><script src="/OpenEXDoc/assets/js/1.80356216.js" defer></script><script src="/OpenEXDoc/assets/js/30.ee69313e.js" defer></script>
  </body>
</html>
